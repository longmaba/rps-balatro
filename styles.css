:root {
  --bg: #0b0f14;
  --panel: #121821;
  --panel-2: #0f141c;
  --ink: #e8f0ff;
  --muted: #9fb0c8;
  --accent: #6ca3ff;
  --good: #37d399;
  --bad: #ff6b6b;
  --gold: #ffcc66;
  --card: #162131;
}

* {
  box-sizing: border-box
}

html,
body {
  height: 100%
}

body {
  margin: 0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
  background: linear-gradient(180deg, var(--bg), #06090d 60%);
  color: var(--ink);
}

.wrap {
  max-width: 1280px;
  margin: 32px auto;
  padding: 0 16px
}

header {
  display: flex;
  gap: 12px;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 16px
}

.pill {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  background: var(--panel);
  border: 1px solid #1f2b3b;
  border-radius: 999px;
  color: var(--ink);
  font-weight: 600
}

.pill small {
  color: var(--muted);
  font-weight: 500
}

.row {
  display: flex;
  gap: 16px;
  flex-wrap: wrap
}

/* Widen match column */
.row>.col:nth-child(1) {
  flex: 1 1 320px
}

.row>.col:nth-child(2) {
  flex: 1.5 1 640px
}

.col {
  flex: 1 1 320px
}

.panel {
  background: var(--panel);
  border: 1px solid #1f2b3b;
  border-radius: 16px;
  padding: 16px;
  box-shadow: 0 1px 0 #223045 inset
}

h1 {
  font-size: 22px;
  margin: 0
}

h2 {
  font-size: 18px;
  margin: 0 0 12px
}

h3 {
  font-size: 16px;
  margin: 0 0 8px
}

.cards {
  display: flex;
  gap: 8px;
  flex-wrap: wrap
}

.card {
  position: relative;
  width: 120px;
  height: 168px;
  border-radius: 16px;
  padding: 12px;
  background: radial-gradient(120% 120% at 50% 0%, #1a2436, #0f1724);
  border: 1px solid #223045;
  color: #e6eeff;
  cursor: pointer;
  user-select: none;
  transition: transform .08s ease, box-shadow .08s ease, border-color .08s ease;
  box-shadow: 0 10px 24px rgba(0, 0, 0, .35), inset 0 0 0 1px rgba(255, 255, 255, .04);
}

.card:hover {
  transform: translateY(-2px);
  box-shadow: 0 14px 28px rgba(0, 0, 0, .45)
}

.card.selected {
  outline: 2px solid var(--accent);
  border-color: #3b82f6
}

.card .emoji {
  font-size: 54px;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 130px;
  margin-top: 8px
}

.card .label {
  position: absolute;
  left: 10px;
  top: 8px;
  font-weight: 700;
  font-size: 12px;
  letter-spacing: .06em;
  text-transform: uppercase;
  color: #bcd0f6
}

.slotbar {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  align-items: center
}

.slot {
  width: 96px;
  height: 132px;
  border-radius: 12px;
  border: 1px dashed #2a3951;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #8aa1c7;
  background: var(--panel-2);
  position: relative
}

.slot.filled {
  border-style: solid;
  border-color: #3a4f72
}

.slot .idx {
  position: absolute;
  top: 6px;
  left: 6px;
  font-size: 11px;
  color: #7290c1
}

.slot .big {
  font-size: 40px
}

.btn {
  appearance: none;
  border: none;
  padding: 10px 14px;
  border-radius: 12px;
  background: #1a2436;
  color: var(--ink);
  border: 1px solid #2a3951;
  cursor: pointer;
  font-weight: 650
}

.btn:hover {
  filter: brightness(1.1)
}

.btn.primary {
  background: #2a3a58;
  border-color: #3b82f6
}

.btn.good {
  background: #193427;
  border-color: #2f855a
}

.btn.bad {
  background: #3a1a1a;
  border-color: #b91c1c
}

.btn:disabled {
  opacity: .5;
  cursor: not-allowed
}

.stack {
  display: flex;
  gap: 8px;
  flex-wrap: wrap
}

.artifact {
  min-width: 200px;
  max-width: 280px;
  background: var(--card);
  border: 1px solid #24364f;
  border-radius: 14px;
  padding: 12px
}

.artifact h4 {
  margin: 0 0 6px;
  font-size: 14px
}

.artifact p {
  margin: 0;
  font-size: 13px;
  color: var(--muted)
}

.muted {
  color: var(--muted)
}

/* Rarity colors */
.rarity { font-weight: 600; }
.rarity-common { color: #9fb0c8; }
.rarity-uncommon { color: #7dd3fc; }
.rarity-rare { color: #fbbf24; }
.rarity-epic { color: #a78bfa; }
.rarity-legendary { color: #f472b6; }


.score {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
  align-items: center;
  background: #0f1622;
  border: 1px solid #223045;
  border-radius: 12px;
  padding: 12px;
  font-weight: 700
}

.score .p {
  color: var(--good)
}

.score .a {
  color: var(--bad)
}

.log {
  height: 220px;
  overflow: auto;
  background: #0e1420;
  border: 1px solid #203049;
  border-radius: 12px;
  padding: 12px;
  font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
  font-size: 13px
}

.log b {
  color: #dbe7ff
}

.divider {
  height: 1px;
  background: #1f2b3b;
  margin: 8px 0 12px
}

.badge {
  display: inline-flex;
  gap: 6px;
  align-items: center;
  padding: 4px 8px;
  font-size: 12px;
  border-radius: 999px;
  background: #172132;
  border: 1px solid #283a58;
  color: #c8d7f4
}

.hidden {
  display: none
}

dialog {
  border: none;
  border-radius: 16px;
  padding: 0;
  overflow: hidden;
  box-shadow: 0 20px 80px rgba(0, 0, 0, .55)
}

dialog .modal {
  background: var(--panel);
  color: var(--ink);
  padding: 16px;
  min-width: 720px
}

dialog::backdrop {
  background: rgba(0, 0, 0, .5)
}

.choices {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px
}

.choice {
  padding: 12px;
  border-radius: 12px;
  border: 1px solid #2a3951;
  background: #121a28;
  cursor: pointer
}

.choice:hover {
  filter: brightness(1.05)
}

.footer {
  display: flex;
  justify-content: flex-end;
  gap: 8px;
  margin-top: 12px
}

.tiny {
  font-size: 12px
}

/* ---------- FX Stage ---------- */
.fxstage {
  min-height: 220px;
  border: 1px dashed #203049;
  border-radius: 12px;
  padding: 10px;
  background: radial-gradient(120% 120% at 50% 0%, #0b1320, #0c121d);
  position: relative;
  overflow: hidden
}

.compareStage {
  display: grid;
  grid-template-columns: 1fr 24px 1fr;
  gap: 8px;
  align-items: center
}

.lane {
  background: #0e1625;
  border: 1px solid #203049;
  border-radius: 12px;
  padding: 10px;
  position: relative;
  min-height: 200px;
  padding-top: 28px;
  padding-bottom: 80px
}

.lane .head {
  display: flex;
  align-items: center;
  gap: 8px;
  font-weight: 700
}

.lane .calc {
  margin-top: 6px;
  font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap
}

.lane .calc .num {
  display: inline-block;
  min-width: 42px
}

.lane .calc .badge.total {
  margin-left: auto
}

/* Move chips to a bottom dock so they do not cover the calc line */
.lane .chips {
  position: absolute;
  right: 8px;
  bottom: 8px;
  left: 8px;
  display: flex;
  flex-wrap: nowrap;
  gap: 6px;
  align-items: center;
  justify-content: flex-start;
  overflow-x: auto;
  padding-bottom: 2px
}

.chip {
  padding: 4px 8px;
  border-radius: 999px;
  background: #14223a;
  border: 1px solid #28406b;
  font-size: 12px;
  color: #cde0ff;
  opacity: 0;
  transform: translateY(6px) scale(.96)
}

.chip.show {
  animation: chip-in .5s ease forwards
}

@keyframes chip-in {
  to {
    opacity: 1;
    transform: translateY(0) scale(1)
  }
}

.bump {
  animation: bump .5s ease
}

@keyframes bump {
  0% {
    transform: scale(1)
  }

  50% {
    transform: scale(1.18)
  }

  100% {
    transform: scale(1)
  }
}

.glow {
  box-shadow: 0 0 0 0 rgba(108, 163, 255, .7);
  animation: glow 0.8s ease
}

@keyframes glow {
  0% {
    box-shadow: 0 0 0 0 rgba(108, 163, 255, .65)
  }

  100% {
    box-shadow: 0 0 0 20px rgba(108, 163, 255, 0)
  }
}

.vs {
  font-weight: 800;
  text-align: center;
  opacity: .7
}

/* Keep result tag inside the lane to avoid clipping */
.resultTag {
  position: absolute;
  right: 8px;
  top: 8px;
  transform: none;
  padding: 4px 10px;
  border-radius: 999px;
  font-weight: 800;
  font-size: 12px;
  z-index: 2
}

.resultTag.win {
  background: #123425;
  color: #9ef3c2;
  border: 1px solid #285f47
}

.resultTag.lose {
  background: #3a1b1b;
  color: #ffbaba;
  border: 1px solid #7a2b2b
}

/* ---------- Trails & Particles ---------- */
.trail {
  position: absolute;
  pointer-events: none;
  font-weight: 900;
  font-size: 14px;
  opacity: .9;
  transform: translate(-50%, -50%) scale(1);
  filter: drop-shadow(0 6px 16px rgba(0, 0, 0, .45));
  animation: trail-rise .9s ease-out forwards
}

.trail.base {
  color: var(--gold);
  text-shadow: 0 0 10px rgba(255, 204, 102, .5)
}

.trail.mult {
  color: var(--accent);
  text-shadow: 0 0 10px rgba(108, 163, 255, .5)
}

.trail.win {
  color: var(--good);
  text-shadow: 0 0 12px rgba(55, 211, 153, .6)
}

.trail.lose {
  color: var(--bad);
  text-shadow: 0 0 12px rgba(255, 107, 107, .6)
}

@keyframes trail-rise {
  0% {
    opacity: .9;
    transform: translate(-50%, -20%) scale(1)
  }

  60% {
    opacity: .7
  }

  100% {
    opacity: 0;
    transform: translate(-50%, -80%) scale(1.2)
  }
}

.particle {
  position: absolute;
  width: 7px;
  height: 7px;
  border-radius: 50%;
  opacity: .95
}

/* ---------- Screen Shake ---------- */
@keyframes shake {
  0% {
    transform: translate(0, 0) rotate(0)
  }

  15% {
    transform: translate(var(--mag, 8px), calc(var(--mag, -8px)*0.5))
  }

  30% {
    transform: translate(calc(var(--mag, -8px)*-0.8), calc(var(--mag, -8px)*0.6)) rotate(-0.6deg)
  }

  45% {
    transform: translate(calc(var(--mag, -8px)*0.6), calc(var(--mag, -8px)*0.6))
  }

  60% {
    transform: translate(calc(var(--mag, -8px)*-0.5), calc(var(--mag, -8px)*-0.6))
  }

  75% {
    transform: translate(calc(var(--mag, -8px)*0.4), 0)
  }

  100% {
    transform: translate(0, 0) rotate(0)
  }
}

.shake {
  animation: shake var(--shake-ms, 650ms) ease
}



/* ---------- Workshop & Recipes ---------- */
.choice.recipe {
  background: #0f1622 radial-gradient(120% 120% at 50% 0%, #0e1420, #0a111d);
  border-color: #375a9e;
}
.choice .badge.recipe {
  display: inline-flex; align-items:center; gap:6px;
  padding: 2px 6px; font-size: 11px; border-radius: 999px;
  background: #132544; border:1px solid #375a9e; color:#cbdcff;
}
.modal.workshop { min-width: 880px; }
.workshop-body { display: grid; grid-template-columns: 280px 1fr; gap: 12px; margin-top: 8px; }
.recipe-list { display: flex; flex-direction: column; gap: 8px; max-height: 340px; overflow:auto; }
.recipe-item { padding: 10px; border-radius: 10px; border:1px solid #2a3951; background:#0f1622; cursor:pointer; }
.recipe-item.selected { outline:2px solid var(--accent); border-color:#3b82f6; }
.recipe-preview { border:1px solid #2a3951; background:#0f1622; border-radius: 12px; padding: 12px; min-height: 220px; }
.requirements { display:flex; gap:6px; flex-wrap:wrap; margin-top:6px }
.req.ok { color: var(--good); }
.req.miss { color: var(--bad); }

